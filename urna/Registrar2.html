<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        h1{
            text-align: center;
        }
        .center {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .center2{
            display:flex; 
            flex-direction:column; 
            justify-content: center; 
            align-items: center;
        }

    </style>
</head>
<body>
    <div>
        <h1 style="size: 20px "> 
            URNA ELECTRÓNICA
        </h1>
    </div>
    <div class="center">
        <form name="form" >
        <h1 style="text-align: center; margin-top: 50px;">Registrar Datos de la Elección</h1>
        <h2 style="text-align: center;  margin-top: 40px;">Presidente Municipal</h2><br>
        </form>
    </div>
    <div class="center2">
        <h3> Nombre y Apellido del candidato: </h3><input id="nombreCandidato" type="name" placeholder="Ej. Maria Perez" required>
        <h3> Partido: </h3>
        <select id="partido">
            <option value="Elije el partido"></option>        
        </select>
        <h3 >Municipio: </h3>
        <select id="municipio">
            <option value="Elije el municipio"></option>        
        </select><br>
        <input type="button" value="Enviar" onclick="createCandidato()">
    </div>
    
</body>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    const sendBtn = document.getElementById("enviar");
    const selectMunicipios = document.getElementById("municipio");
    const selectPartidos = document.getElementById("partido");

    const baseurl = 'http://localhost:4000';

    const getMunicipios = async() => {
        const { data } = await axios.get(baseurl + '/municipios');
        data.forEach(function(item) {
            let o = document.createElement('option');
            o.text = item.municipio_nombre;
            o.value = item.municipio_id;
            municipio.appendChild(o);
        });
    }
    const getPartidos = async() => {
        const { data } = await axios.get(baseurl + '/partidos');
            data.forEach(function(item) {
                let p = document.createElement('option');
                p.text = item.partido_nombre;
                p.value = item.partido_id;
                partido.appendChild(p);
            });  
    
    }
    const createCandidato = async() => {
        var selectPartido = document.getElementById('partido');
        var partidoValue = selectPartido.options[selectPartido.selectedIndex].value;
        console.log(document.getElementById("partido").value)
        
        var selectMunicipio = document.getElementById('municipio');
        var municipioValue = selectMunicipio.options[selectMunicipio.selectedIndex].value;
        console.log(document.getElementById("municipio").value)

        const res = await axios.post(baseurl + '/candidato', {
            nombreCandidato: document.getElementById('nombreCandidato').value,
            municipioId: municipioValue,
            partidoId: partidoValue,
            eleccionId: 2,
            puestoId: 1
        });        
        let text;
        if (confirm("¿Quiere Registrar otro Candidato a Presidente Municipal?") == true) {
            text = "You pressed OK!";
            document.getElementById("partido").value = null
            document.getElementById("municipio").value = null
            document.getElementById('nombreCandidato').value = null
        } else {
            window.location='Registrar3.html'
        }
        
    }
    
    getMunicipios();
    getPartidos();   
   

</script>
</html> 

